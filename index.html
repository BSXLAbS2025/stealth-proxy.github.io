<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Browser</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        #urlInput {
            width: 70%;
            padding: 10px;
            margin-right: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        #fetchBtn {
            padding: 10px 20px;
            background: #007cba;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #fetchBtn:hover {
            background: #005a87;
        }
        #result {
            margin-top: 20px;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            min-height: 300px;
            background: #fafafa;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîí Secure Web Access</h1>
        
        <div class="status hidden" id="status"></div>
        
        <div>
            <input type="url" id="urlInput" placeholder="https://example.com" value="https://httpbin.org/ip">
            <button id="fetchBtn">–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        </div>
        
        <div id="result">
            <p>–í–≤–µ–¥–∏—Ç–µ URL –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"</p>
        </div>
        
        <div style="margin-top: 20px; font-size: 12px; color: #666;">
            <p><strong>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</strong> –ó–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é —Å–µ—Ç—å –ø—Ä–æ–∫—Å–∏ –Ω–∞ –±–∞–∑–µ GitHub Pages –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.</p>
        </div>
    </div>

    <script>
        class StealthClient {
            constructor() {
                this.configUrl = '/config.json';
                this.proxies = [];
                this.currentProxyIndex = 0;
                this.retryCount = 0;
                this.maxRetries = 3;
            }

            async initialize() {
                await this.loadConfig();
                await this.testProxies();
                this.showStatus('–°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞', 'success');
            }

            async loadConfig() {
                try {
                    // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
                    const response = await fetch(this.configUrl + '?v=' + Date.now());
                    const config = await response.json();
                    this.proxies = [...config.proxies, ...config.backup_proxies];
                    console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ –ø—Ä–æ–∫—Å–∏:', this.proxies.length);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥–∞:', error);
                    this.showStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏', 'error');
                }
            }

            async testProxies() {
                const testUrl = 'https://httpbin.org/ip';
                const workingProxies = [];

                for (let proxy of this.proxies) {
                    try {
                        const result = await this.makeRequest(proxy, testUrl);
                        if (result && result.origin) {
                            workingProxies.push(proxy);
                            console.log('–ü—Ä–æ–∫—Å–∏ —Ä–∞–±–æ—á–∏–π:', proxy);
                        }
                    } catch (error) {
                        console.log('–ü—Ä–æ–∫—Å–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:', proxy, error);
                    }
                }

                this.proxies = workingProxies;
                console.log('–†–∞–±–æ—á–∏—Ö –ø—Ä–æ–∫—Å–∏:', this.proxies.length);
            }

            async fetchUrl(targetUrl) {
                if (!this.proxies.length) {
                    await this.loadConfig();
                }

                for (let i = 0; i < this.maxRetries; i++) {
                    try {
                        const proxy = this.getNextProxy();
                        const result = await this.makeRequest(proxy, targetUrl);
                        this.retryCount = 0;
                        return result;
                    } catch (error) {
                        console.error(`–ü–æ–ø—ã—Ç–∫–∞ ${i + 1} failed:`, error);
                        this.retryCount++;
                        
                        // –ñ–¥–µ–º –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π
                        await new Promise(resolve => setTimeout(resolve, 1000 * this.retryCount));
                    }
                }
                
                throw new Error('–í—Å–µ –ø—Ä–æ–∫—Å–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã');
            }

            getNextProxy() {
                const proxy = this.proxies[this.currentProxyIndex];
                this.currentProxyIndex = (this.currentProxyIndex + 1) % this.proxies.length;
                return proxy;
            }

            async makeRequest(proxyBase, targetUrl) {
                // –ö–æ–¥–∏—Ä—É–µ–º URL –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏
                const encodedUrl = btoa(targetUrl);
                const proxyUrl = `${proxyBase}?url=${encodedUrl}&t=${Date.now()}`;
                
                console.log('–î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑:', proxyUrl);

                const response = await fetch(proxyUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json,text/html,*/*',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    mode: 'cors'
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const contentType = response.headers.get('content-type');
                
                if (contentType && contentType.includes('application/json')) {
                    return await response.json();
                } else {
                    return await response.text();
                }
            }

            showStatus(message, type) {
                const statusEl = document.getElementById('status');
                statusEl.textContent = message;
                statusEl.className = `status ${type}`;
                statusEl.classList.remove('hidden');
                
                setTimeout(() => {
                    statusEl.classList.add('hidden');
                }, 5000);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
        const client = new StealthClient();

        document.addEventListener('DOMContentLoaded', async function() {
            await client.initialize();
            
            document.getElementById('fetchBtn').addEventListener('click', async function() {
                const urlInput = document.getElementById('urlInput');
                const resultDiv = document.getElementById('result');
                const url = urlInput.value.trim();
                
                if (!url) {
                    client.showStatus('–í–≤–µ–¥–∏—Ç–µ URL', 'error');
                    return;
                }

                try {
                    client.showStatus('–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ...', 'success');
                    resultDiv.innerHTML = '<p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>';
                    
                    const result = await client.fetchUrl(url);
                    
                    if (typeof result === 'string') {
                        // –ï—Å–ª–∏ —ç—Ç–æ HTML, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ iframe
                        resultDiv.innerHTML = `
                            <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
                            <iframe srcdoc="${result.replace(/"/g, '&quot;')}" 
                                    style="width: 100%; height: 400px; border: 1px solid #ddd;"></iframe>
                        `;
                    } else {
                        // –ï—Å–ª–∏ JSON, —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º
                        resultDiv.innerHTML = `
                            <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
                            <pre>${JSON.stringify(result, null, 2)}</pre>
                        `;
                    }
                    
                    client.showStatus('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ', 'success');
                } catch (error) {
                    console.error('Error:', error);
                    resultDiv.innerHTML = `
                        <p style="color: red;">–û—à–∏–±–∫–∞: ${error.message}</p>
                        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π URL –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É</p>
                    `;
                    client.showStatus('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö', 'error');
                }
            });

            // Enter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            document.getElementById('urlInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('fetchBtn').click();
                }
            });
        });
    </script>
</body>
</html>
